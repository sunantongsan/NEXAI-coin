<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>NEXAI Web Wallet</title>
<style>
body { font-family: sans-serif; max-width: 600px; margin:auto; padding:20px; }
input, button{padding:10px;width:100%; margin:5px 0;} button{cursor:pointer;}
</style>
</head>
<body>
<h1>NEXAI Web Wallet</h1>

<div>
<h2>สร้าง Wallet</h2>
<button onclick="createWallet()">สร้าง</button>
<div id="walletInfo"></div>
</div>

<div>
<h2>ส่งเหรียญ</h2>
<input id="toAddr" placeholder="Address ผู้รับ"/>
<input id="amount" placeholder="จำนวน NXI" type="number"/>
<button onclick="send()">ส่ง</button>
</div>

<div>
<h2>Balance</h2>
<p id="balance">0 NXI</p>
</div>

<script>
const API = "http://localhost:3000";
let wallet=null;
let coinId=null;

async function createWallet(){
    const res = await fetch(API+'/createWallet',{method:'POST'});
    const data = await res.json();
    wallet={address:data.address,seed:data.seed};
    document.getElementById('walletInfo').innerText=`Address: ${data.address}\nSeed: ${data.seed}`;
    coinId = data.seed; // ใช้ seed เป็น ID ของเหรียญ AI
    await fetch(API+'/coinOnline',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({coinId,owner:wallet.address})
    });
    updateBalance();
}

async function updateBalance(){
    if(!wallet) return;
    const res = await fetch(API+'/balance/'+wallet.address);
    const data = await res.json();
    document.getElementById('balance').innerText = data.balance + " NXI";
}

async function send(){
    const to = document.getElementById('toAddr').value;
    const amount = parseFloat(document.getElementById('amount').value);
    if(!wallet || !to || isNaN(amount)) return alert("ข้อมูลไม่ถูกต้อง");
    const res = await fetch(API+'/send',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({from:wallet.address,to,amount})
    });
    const data = await res.json();
    if(data.error) return alert(data.error);
    updateBalance();
    alert("ส่งเรียบร้อย");
}
</script>
</body>
</html>
